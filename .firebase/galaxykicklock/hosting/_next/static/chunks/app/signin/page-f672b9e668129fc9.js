(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{3807:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m});var n=t(5155),a=t(2115),r=t(5695),i=t(6302),o=t(6874),l=t.n(o),c=t(5799);t(5716);let u=(0,i.UU)("https://sarsafeqetopciqjhzrt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhcnNhZmVxZXRvcGNpcWpoenJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAwOTEsImV4cCI6MjA0NzkyNjA5MX0.cvIbQn7UbCrvjDVzA4-bB-UCsHM9gp9i1uVFWtPlH9c"),d={SESSION_TOKEN:"sessionToken",USER_ID:"userId",USERNAME:"username",SESSION_ID:"sessionId"};function m(){let[e,s]=(0,a.useState)(""),[t,i]=(0,a.useState)(""),[o,m]=(0,a.useState)(!1),p=(0,r.useRouter)(),S=(0,a.useRef)(null),I=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";c.oR[s](e,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"dark"})},g=()=>{let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")+Date.now().toString(36)},h=()=>crypto.randomUUID(),f=()=>{Object.values(d).forEach(e=>sessionStorage.removeItem(e))},_=()=>({userId:sessionStorage.getItem(d.USER_ID),sessionToken:sessionStorage.getItem(d.SESSION_TOKEN),username:sessionStorage.getItem(d.USERNAME),sessionId:sessionStorage.getItem(d.SESSION_ID)}),w=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Your session has ended.",{userId:s}=_();if(s)try{let{error:e}=await u.from("users").update({session_token:null,active_session_id:null,last_logout:new Date().toISOString()}).eq("id",s);if(e){I("Session could not be terminated properly");return}await u.channel("session_updates").send({type:"broadcast",event:"session_terminated",payload:{userId:parseInt(s)}})}catch(e){I("Failed to properly end session")}finally{f(),p.push("/"),I(e)}};(0,a.useEffect)(()=>((async()=>{let e=sessionStorage.getItem(d.USER_ID);e&&(S.current=u.channel("session_updates").on("broadcast",{event:"session_terminated"},async s=>{s.userId===parseInt(e)&&await w("Your session was ended due to a new login.")}).subscribe())})(),()=>{S.current&&S.current.unsubscribe()}),[p]);let b=()=>e.trim()&&t.trim()?!(t.length<8)||(I("Password must be at least 8 characters"),!1):(I("Username and password are required"),!1),N=async()=>{try{let{data:s,error:n}=await u.from("users").select("id, username, password, active_session_id, login_count").eq("username",e).single();if(n||!s||s.password!==t)return I("Invalid credentials"),null;return s}catch(e){return I("An error occurred during authentication"),null}},v=async(e,s,t,n)=>{let{error:a}=await u.from("users").update({session_token:s,active_session_id:t,login_count:n+1,last_login:new Date().toISOString()}).eq("id",e);if(a)throw a},y=(e,s,t,n)=>{sessionStorage.setItem(d.SESSION_TOKEN,e),sessionStorage.setItem(d.USER_ID,s),sessionStorage.setItem(d.USERNAME,t),sessionStorage.setItem(d.SESSION_ID,n)},x=()=>{p.push("/profile?username="+encodeURIComponent(e))},E=async e=>{if(e.preventDefault(),!o){m(!0);try{if(!b())return;let e=await N();if(!e)return;let s=g(),t=h();if(e.active_session_id){let{error:s}=await u.from("users").update({session_token:null,active_session_id:null,last_logout:new Date().toISOString()}).eq("id",e.id);if(s)throw Error("Failed to terminate existing session.");await u.channel("session_updates").send({type:"broadcast",event:"session_terminated",payload:{userId:e.id}})}await v(e.id.toString(),s,t,e.login_count),y(s,e.id.toString(),e.username,t),I("Successfully signed in!","success"),setTimeout(()=>{x()},1e3)}catch(e){I("An error occurred during sign in")}finally{m(!1)}}};return(0,n.jsxs)("div",{className:"welcome-container",children:[(0,n.jsx)(c.N9,{}),(0,n.jsxs)("div",{className:"auth-card max-w-md w-full p-8",children:[(0,n.jsx)("h1",{className:"text-center mb-8",children:(0,n.jsx)("span",{style:{color:"#D32F2F",fontFamily:"Audiowide, cursive",fontSize:"2rem",textShadow:"0 0 10px rgba(211, 47, 47, 0.3)"},children:"KICK ~ LOCK"})}),(0,n.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"block text-white text-sm font-semibold mb-2 text-left w-full",children:"Username"}),(0,n.jsx)("input",{type:"text",value:e,onChange:e=>s(e.target.value),className:"input-field",placeholder:"Enter username",disabled:o})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"block text-white text-sm font-semibold mb-2 text-left w-full",children:"Password"}),(0,n.jsx)("input",{type:"password",value:t,onChange:e=>i(e.target.value),className:"input-field",placeholder:"Enter password",disabled:o})]}),(0,n.jsx)("button",{type:"submit",className:"welcome-button w-full mt-6",disabled:o,children:o?"Signing in...":"Sign In"})]}),(0,n.jsx)("div",{className:"mt-6 text-center",children:(0,n.jsx)(l(),{href:"/signup",className:"text-primary-color hover:text-secondary-color transition-colors",children:"Don't have an account? Sign up"})})]})]})}},4201:(e,s,t)=>{Promise.resolve().then(t.bind(t,3807))}},e=>{var s=s=>e(e.s=s);e.O(0,[454,948,874,542,441,684,358],()=>s(4201)),_N_E=e.O()}]);