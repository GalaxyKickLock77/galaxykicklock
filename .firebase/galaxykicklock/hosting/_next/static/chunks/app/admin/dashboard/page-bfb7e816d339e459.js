(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{4163:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(5155),s=r(6302),a=r(2115),o=r(5695);let l=(0,s.UU)("https://sarsafeqetopciqjhzrt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhcnNhZmVxZXRvcGNpcWpoenJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAwOTEsImV4cCI6MjA0NzkyNjA5MX0.cvIbQn7UbCrvjDVzA4-bB-UCsHM9gp9i1uVFWtPlH9c"),i={ADMIN_ID:"adminId",ADMIN_USERNAME:"adminUsername",ADMIN_SESSION_ID:"adminSessionId"};function c(){let e=(0,o.useRouter)(),[t,r]=(0,a.useState)(""),[s,c]=(0,a.useState)({"3month":"","6month":"","1year":""}),[d,u]=(0,a.useState)({"3month":!1,"6month":!1,"1year":!1}),[m,h]=(0,a.useState)({"3month":{},"6month":{},"1year":{}}),[x,p]=(0,a.useState)({"3month":[],"6month":[],"1year":[]}),[g,f]=(0,a.useState)([]),[b,y]=(0,a.useState)(!1),[k,w]=(0,a.useState)(null),[N,j]=(0,a.useState)("3month"),[v,I]=(0,a.useState)(!1),[E,S]=(0,a.useState)(null),[D,U]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=localStorage.getItem(i.ADMIN_USERNAME);e&&r(e)},[]),(0,a.useEffect)(()=>{let t=t=>{"admin_logout_event"===t.key&&e.push("/admin")};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},[e]);let A=e=>{U(e),setTimeout(()=>U(null),3e3)},C=e=>{navigator.clipboard.writeText(e).then(()=>{A("Token copied to clipboard!")})},T=e=>{let t={"3month":"","6month":"","1year":""};Object.entries(e).forEach(e=>{let[r,n]=e,s=n.find(e=>"Active"===e.status);s&&(t[r]=s.token)}),c(t)},M=async e=>{u(t=>({...t,[e]:!0}));try{let t=Array(16).fill(0).map(()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return e.charAt(Math.floor(Math.random()*e.length))}).join(""),{data:r,error:n}=await l.from("tokengenerate").insert([{token:t,duration:e,status:"Active"}]).select();if(n)throw n;if(r){let n={...x,[e]:[{token:t,status:"Active",id:r[0].id},...x[e].length>=5?x[e].slice(0,4):x[e]]};p(n),T(n),A("Token generated successfully!")}}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error in generateToken:",t),A("Error: ".concat(e))}finally{u(t=>({...t,[e]:!1}))}},O=async(e,t)=>{if(!e){console.error("Token ID is undefined. Cannot delete."),A("Error deleting token: Token ID is missing.");return}h(r=>({...r,[t]:{...r[t],[e]:!0}}));try{let{error:r}=await l.from("tokengenerate").delete().eq("id",e);if(r)throw r;let n={...x,[t]:x[t].filter(t=>t.id!==e)};p(n),T(n),V()}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error during token deletion:",t),A("Error deleting token: ".concat(e))}finally{h(r=>({...r,[t]:{...r[t],[e]:!1}}))}},J=async(e,t)=>{if(!e||!t){console.error("User ID or Token is missing."),A("Error: User ID or Token is missing.");return}try{let{error:r}=await l.from("users").delete().eq("id",e);if(r)throw r;let{error:n}=await l.from("tokengenerate").delete().eq("token",t);if(n)throw n;console.log("User and associated token deleted successfully!"),A("User and associated token deleted successfully!");let s={...x};Object.keys(s).forEach(e=>{s[e]=s[e].filter(e=>e.token!==t)}),p(s),T(s),V()}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error in handleDeleteUser:",e),A("Error: ".concat(e))}},_=(e,t)=>{S({userId:e,token:t}),I(!0)},q=()=>{I(!1),S(null)},R=async e=>{if(!E)return;let{userId:t,token:r}=E;if("token"===e)try{let{error:e}=await l.from("tokengenerate").delete().eq("token",r);if(e)throw e;let{error:n}=await l.from("users").update({token:null}).eq("id",t);if(n)throw n;let s={...x};Object.keys(s).forEach(e=>{s[e]=s[e].filter(e=>e.token!==r)}),p(s),T(s),A("Token deleted successfully!"),V()}catch(e){console.error("Error deleting token:",e),A("Error deleting token")}else"user"===e&&J(t,r);q()},z=e=>{w(e),y(!0)},G=()=>{y(!1),w(null),j("3month")},F=async()=>{if(!k){console.error("User ID is missing."),A("Error: User ID is missing.");return}try{let{data:e,error:t}=await l.from("tokengenerate").select("token, expiresat").eq("userid",k).not("token","is",null).neq("token","").single();if(t&&"PGRST116"!==t.code)throw t;if(e){let t=new Date(e.expiresat);if(new Date<t){A("User already has an active token. Please delete the existing token before renewing.");return}{let{error:t}=await l.from("tokengenerate").delete().eq("token",e.token);if(t)throw t}}let r=Array(16).fill(0).map(()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return e.charAt(Math.floor(Math.random()*e.length))}).join(""),n=new Date().toISOString(),s=new Date;switch(N){case"3month":s.setMonth(s.getMonth()+3);break;case"6month":s.setMonth(s.getMonth()+6);break;case"1year":s.setFullYear(s.getFullYear()+1);break;default:throw Error("Invalid duration")}let{data:a,error:o}=await l.from("tokengenerate").insert([{token:r,createdat:n,expiresat:s.toISOString(),duration:N,status:"InUse",userid:k}]).select();if(o)throw o;let{data:i,error:c}=await l.from("users").update({token:r}).eq("id",k).select();if(c)throw c;a&&i&&(A("Token renewed successfully!"),V(),L(),G())}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error renewing token:",e),A("Error renewing token: ".concat(e))}},L=(0,a.useCallback)(async()=>{try{let{data:e,error:t}=await l.from("tokengenerate").select("id, token, status, duration, createdat, expiresat, userid").order("createdat",{ascending:!1});if(t)throw t;let r={"3month":[],"6month":[],"1year":[]};e.forEach(e=>{r[e.duration]&&r[e.duration].push({token:e.token,status:e.status,id:e.id})}),p(r),T(r)}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error fetching token history:",e)}},[]),V=async()=>{try{let{data:e,error:t}=await l.from("users").select("id, username, token");if(t)throw t;let{data:r,error:n}=await l.from("tokengenerate").select("token, duration, createdat, expiresat, userid");if(n)throw n;let s=e.map(e=>{let t=r.find(t=>t.userid===e.id);return{token:(null==t?void 0:t.token)||e.token||"N/A",duration:(null==t?void 0:t.duration)||"N/A",createdat:(null==t?void 0:t.createdat)||"N/A",expiresat:(null==t?void 0:t.expiresat)||null,username:e.username||"N/A",userId:e.id||null}});f(s)}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error fetching token user details:",e)}};(0,a.useEffect)(()=>{V(),L()},[L]);let X=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),Y=e=>new Date>new Date(e),Z=(e,t)=>"N/A"===e||null===t?"N/A":Y(t)?"Expired":"InUse";return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:[(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between mb-4 items-center",children:[(0,n.jsxs)("div",{className:"text-xl font-semibold",children:["Welcome, ",t||"Admin"]}),(0,n.jsx)("button",{onClick:()=>{Object.values(i).forEach(e=>localStorage.removeItem(e)),localStorage.setItem("admin_logout_event",Date.now().toString()),e.push("/admin")},className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Logout"})]}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Admin Dashboard - Token Generator"}),D&&(0,n.jsx)("div",{className:"fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg",children:D}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Object.keys(s).map(e=>(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,n.jsxs)("h3",{className:"text-lg font-bold mb-4",children:[e.charAt(0).toUpperCase()+e.slice(1)," Token"]}),(0,n.jsxs)("div",{className:"bg-gray-700 p-3 rounded mb-4 break-all flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm font-mono flex-1 truncate mr-2",children:s[e]?s[e]:"No active token"}),(0,n.jsx)("span",{className:"text-xs ".concat(s[e]?"text-green-500":"text-gray-400"),children:s[e]?"Active":""})]}),(0,n.jsx)("button",{className:"w-full py-2 px-4 rounded font-semibold ".concat(d[e]?"bg-purple-700 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"),onClick:()=>M(e),disabled:d[e],children:d[e]?"Generating...":"Generate Token"}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h4",{className:"text-sm font-bold mb-2",children:"Token History"}),(0,n.jsx)("div",{className:"max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-purple-600 scrollbar-track-gray-700 scrollbar-rounded",children:x[e].map((t,r)=>(0,n.jsxs)("div",{className:"bg-gray-700 p-2 rounded mb-2 text-sm flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex-1 truncate mr-2",children:[(0,n.jsx)("span",{className:"font-mono",children:t.token}),(0,n.jsx)("span",{className:"ml-2 ".concat("Active"===t.status?"text-green-500":"InUse"===t.status?"text-red-500":"text-gray-400"),children:t.status})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>C(t.token),className:"text-blue-500 hover:text-blue-700 px-2 py-1 rounded",children:"Copy"}),"Active"===t.status&&(0,n.jsx)("button",{onClick:()=>O(t.id,e),disabled:m[e][t.id]||!1,className:"text-red-500 hover:text-red-700 px-2 py-1 rounded ".concat(m[e][t.id]?"opacity-50 cursor-not-allowed":""),children:m[e][t.id]?"Deleting...":"Delete"})]})]},r))})]})]},e))}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Token User Details"}),(0,n.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full table-auto border border-gray-600",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-700",children:[(0,n.jsx)("th",{className:"px-4 py-2 min-w-[200px] text-left",children:"Token"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[100px] text-left",children:"Duration"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[150px] text-left",children:"Username"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[200px] text-left",children:"Created At"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[200px] text-left",children:"Expires At"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[100px] text-left",children:"Status"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[100px] text-left",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:g.length>0?g.map((e,t)=>{let r=Z(e.token,e.expiresat);return(0,n.jsxs)("tr",{className:"text-sm ".concat(t%2==0?"bg-gray-800":"bg-gray-700"," hover:bg-gray-600"),children:[(0,n.jsx)("td",{className:"px-4 py-2 break-all whitespace-nowrap",children:e.token}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.duration}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.username}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:X(e.createdat)}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.expiresat?X(e.expiresat):"N/A"}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded text-sm ".concat("InUse"===r?"bg-red-500":"Expired"===r?"bg-green-500":"bg-yellow-500"),children:r})}),(0,n.jsxs)("td",{className:"px-4 py-2 whitespace-nowrap",children:[(0,n.jsx)("button",{onClick:()=>{e.userId&&e.token?_(e.userId,e.token):(console.error("User ID or Token is missing."),A("Error: User ID or Token is missing."))},className:"text-red-500 hover:text-red-700 px-2 py-1 rounded",children:"Delete"}),(0,n.jsx)("button",{onClick:()=>{e.userId?z(e.userId):(console.error("User ID is missing."),A("Error: User ID is missing."))},className:"text-blue-500 hover:text-blue-700 px-2 py-1 rounded ml-2",children:"Renew Token"})]})]},t)}):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"text-center py-4",children:"No token user details available."})})})]})})]})]}),b&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96",children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Renew Token"}),(0,n.jsxs)("label",{className:"block mb-4",children:[(0,n.jsx)("span",{className:"text-sm font-semibold",children:"Select Duration:"}),(0,n.jsxs)("select",{value:N,onChange:e=>j(e.target.value),className:"w-full p-2 bg-gray-700 rounded mt-1",children:[(0,n.jsx)("option",{value:"3month",children:"3 Months"}),(0,n.jsx)("option",{value:"6month",children:"6 Months"}),(0,n.jsx)("option",{value:"1year",children:"1 Year"})]})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{onClick:G,className:"bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded",children:"Cancel"}),(0,n.jsx)("button",{onClick:F,className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded",children:"Renew"})]})]})}),v&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96",children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Delete Confirmation"}),(0,n.jsx)("p",{className:"mb-4",children:"What do you want to delete?"}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{onClick:()=>R("token"),className:"bg-red-600 hover:text-red-700 px-4 py-2 rounded",children:"Delete Token"}),(0,n.jsx)("button",{onClick:()=>R("user"),className:"bg-red-600 hover:text-red-700 px-4 py-2 rounded",children:"Delete User"}),(0,n.jsx)("button",{onClick:q,className:"bg-gray-600 hover:text-gray-700 px-4 py-2 rounded",children:"Cancel"})]})]})})]})}},6778:(e,t,r)=>{Promise.resolve().then(r.bind(r,4163))}},e=>{var t=t=>e(e.s=t);e.O(0,[948,441,684,358],()=>t(6778)),_N_E=e.O()}]);